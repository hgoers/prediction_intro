<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Finding Patterns Over Time – From Polls to Playoffs: The Science of Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./03_time_series_r.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04_time_series_decomposed.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Finding Patterns Over Time</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">From Polls to Playoffs: The Science of Prediction</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_whole_game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Forecasting Landscape</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_time_series_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The Toolkit: R for Time Series</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_time_series_decomposed.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Finding Patterns Over Time</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-art-of-decomposition" id="toc-the-art-of-decomposition" class="nav-link active" data-scroll-target="#the-art-of-decomposition"><span class="header-section-number">4.1</span> The Art of Decomposition</a></li>
  <li><a href="#seasons-and-cycles" id="toc-seasons-and-cycles" class="nav-link" data-scroll-target="#seasons-and-cycles"><span class="header-section-number">4.2</span> Seasons and cycles</a>
  <ul class="collapse">
  <li><a href="#identifying-the-seasons" id="toc-identifying-the-seasons" class="nav-link" data-scroll-target="#identifying-the-seasons"><span class="header-section-number">4.2.1</span> Identifying the seasons</a></li>
  <li><a href="#white-noise" id="toc-white-noise" class="nav-link" data-scroll-target="#white-noise"><span class="header-section-number">4.2.2</span> White noise</a></li>
  </ul></li>
  <li><a href="#decomposing-time-series" id="toc-decomposing-time-series" class="nav-link" data-scroll-target="#decomposing-time-series"><span class="header-section-number">4.3</span> Decomposing time series</a>
  <ul class="collapse">
  <li><a href="#calculating-the-components-of-your-time-series" id="toc-calculating-the-components-of-your-time-series" class="nav-link" data-scroll-target="#calculating-the-components-of-your-time-series"><span class="header-section-number">4.3.1</span> Calculating the components of your time series</a></li>
  <li><a href="#seasonally-adjusted-data" id="toc-seasonally-adjusted-data" class="nav-link" data-scroll-target="#seasonally-adjusted-data"><span class="header-section-number">4.3.2</span> Seasonally-adjusted data</a></li>
  </ul></li>
  <li><a href="#measuring-the-strength-of-trend-and-seasonality-in-a-time-series" id="toc-measuring-the-strength-of-trend-and-seasonality-in-a-time-series" class="nav-link" data-scroll-target="#measuring-the-strength-of-trend-and-seasonality-in-a-time-series"><span class="header-section-number">4.4</span> Measuring the strength of trend and seasonality in a time series</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Finding Patterns Over Time</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="the-art-of-decomposition" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="the-art-of-decomposition"><span class="header-section-number">4.1</span> The Art of Decomposition</h2>
<p>At its core, time series forecasting is about recognizing patterns. When we look at a time series—like a stock price, a monthly sales figure, or a political approval rating—what we see is often a messy, complicated line. Our goal in this chapter is to develop the skills to explore and formalize the relationship between our outcome of interest and time itself by breaking that messy line into three cleaner, more predictable components: the <strong>Trend</strong>, the <strong>Seasonality</strong>, and the <strong>Remainder</strong>.</p>
<p>This process is called <strong>Time Series Decomposition</strong>. It’s like taking apart a complex machine (the time series) into its simple, functional components. Once we understand how each component works in isolation, we can put them back together to make powerful predictions.</p>
<p>The decomposition model we rely on is generally expressed as:</p>
<p>Trends</p>
<p>Let’s take another look at Mr Trump’s approval rating over his current term in office, which is shown in <a href="#fig-trump-approval" class="quarto-xref">Figure&nbsp;<span>4.1</span></a>. If I asked you to summarize how his popularity was tracking, what would you say?</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-trump-approval" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trump-approval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-trump-approval-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trump-approval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Mr Trump’s approval ratings since entering his second term in office.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In general, his approval rating is decreasing. In fact, I can draw a straight line through these data to capture that downward trend, as I have done in <a href="#fig-trump-approval-lm" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>. A <strong>trend</strong> exists when there is a long-term increase or decrease in the data. We use the trend to describe the general pattern of our data, ignoring small or random fluctuations and noise.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-trump-approval-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-trump-approval-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-trump-approval-lm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-trump-approval-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Mr Trump’s approval ratings since entering his second term in office.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Trends do not need to be linear. For example, <a href="#fig-gdp" class="quarto-xref">Figure&nbsp;<span>4.3</span></a> shows global Gross Domestic Product (GDP) from 1952 to 2007. In general, GDP is growing at an increasing rate. Therefore, its trend is positive and exponential.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gdp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gdp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-gdp-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gdp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Global Gross Domestic Product from 1952 to 2007.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Trends are useful summaries of the general relationship between your variable of interest and time. By stripping away fluctuations from this general pattern, we gain a better understanding of the broad thrust of our data. We will learn how to do this formally shortly.</p>
</section>
<section id="seasons-and-cycles" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="seasons-and-cycles"><span class="header-section-number">4.2</span> Seasons and cycles</h2>
<p>Some of those fluctuations away from our trend are important. This is especially the case when they occur repeatedly. A <strong>seasonal pattern</strong> occurs when a time series deviates from its trend with some pattern and at regular intervals. Seasonality is always of a fixed and known period. On the other hand, a <strong>cycle</strong> occurs when a time series rises and falls in a regular pattern away from its trend, but not at a fixed frequency.</p>
<p>Let’s focus on a seasonal pattern in some political data. Voter turnout rates in US general elections are always higher than they were two years previously, as shown in <a href="#fig-us-turnout" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>. This is because mid-term general elections consistently get a lower turnout than presidential general elections.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-us-turnout" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-us-turnout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-us-turnout-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-us-turnout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: Eligible voter turnout rates at the federal level to US General Elections from 1998 to 2022.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in <a href="#fig-us-state-turnout" class="quarto-xref">Figure&nbsp;<span>4.5</span></a>, we can see this saw-tooth, seasonal pattern generally holds across the 50 US states and the District of Columbia.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-us-state-turnout" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-us-state-turnout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-us-state-turnout-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-us-state-turnout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5: Eligible voter turnout rates in all 50 US states and the District of Columbia to US General Elections from 1998 to 2022.
</figcaption>
</figure>
</div>
</div>
</div>
<p>When trying to understand the relationship between voter turnout and time (for example, if we want to predict next election’s turnout rate), we should account for these patterns.</p>
<section id="identifying-the-seasons" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="identifying-the-seasons"><span class="header-section-number">4.2.1</span> Identifying the seasons</h3>
<p>We can more formally identify whether our time series is seasonal than by eyeballing these patterns. These patterns are defined across time. So, we can look at how the value changes over time to identify that pattern. For example, we can identify the saw-tooth pattern in US voter turnout by comparing each value to its previous value. If those comparisons match their counterparts, we have evidence of a repeated pattern.</p>
<p>This is best understood through an illustration. To begin, let’s use a <strong>lag plot</strong>. This plots each value against its previous value, lagged by varying time periods. The value is plotted on the y-axis and its corresponding lagged value is plotted on the x-axis.</p>
<p><a href="#fig-lag-us-turnout" class="quarto-xref">Figure&nbsp;<span>4.6</span></a> is a lag plot of US general election turnout rates. The first plot, titled <em>lag 1</em>, plots each election’s turnout rate against the turnout rate of the previous election. So the turnout rate for the 2022 election is plotted (on the y-axis) against the turnout rate for the 2020 election (x-axis). The second plot, titled <em>lag 2</em>, plots each election’s turnout rate against the turnout rate of two elections ago. The turnout rate for the 2022 election is plotted against the turnout rate for the 2018 election.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>us_turnout_ts <span class="sc">|&gt;</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"United States"</span>, year <span class="sc">&gt;=</span> <span class="dv">1998</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(vep_turnout_rate, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Turnout rate lagged (%)"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Turnout rate (%)"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Data source: University of Florida Election Lab"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lag-us-turnout" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lag-us-turnout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-lag-us-turnout-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lag-us-turnout-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.6: Lag plot of US general election turnout rates from 1998 to 2022.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If the two election turnout rates are exactly the same, they will fall on the dashed grey line cutting diagonally through each plot. If the two election rates are very different from one another, they will cluster in the upper left hand or lower right hand corners of the plots.</p>
<p>Odd numbered lags (1, 3, 5, 7, and 9) plot turnout rates for mid-term and presidential elections against each other (for example, the 2022 mid-term election is plotted against the 2020 presidential election in <em>lag 1</em>). We consistently see two clusters of dots sitting in opposite corners of those graphs. This means that their turnout rates tend to be very different from each other. More formally, these values are <strong>strongly negatively (auto)correlated</strong>.</p>
<p>Even numbered lags (2, 4, 6, and 8) are plotting like-for-like elections: mid-terms against mid-terms and presidentials against presidentials. We see a <strong>strong positive (auto)correlation</strong> in these plots. The dots are scattered close to the horizontal dashed line that represents equal values.</p>
<p>Strong correlations between values and their lagged counterparts at regular intervals are evidence of seasonality. (If these correlations occur at <em>irregular</em> intervals, this is evidence of cycles.) We can calculate these correlations using <code>feasts::ACF()</code>. They are called <strong>autocorrelations</strong> because we are looking for the relationships lurking within the variable itself.</p>
<p>Let’s look at <strong>autocorrelation coefficients</strong> for up to eight lagged election years:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>us_turnout_autocor <span class="ot">&lt;-</span> us_turnout_ts <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"United States"</span>, year <span class="sc">&gt;=</span> <span class="dv">1998</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(<span class="at">var =</span> vep_turnout_rate, <span class="at">lag_max =</span> <span class="dv">8</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>us_turnout_autocor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 8 x 3 [2Y]
# Key:       state [1]
  state              lag    acf
  &lt;chr&gt;         &lt;cf_lag&gt;  &lt;dbl&gt;
1 United States       2Y -0.722
2 United States       4Y  0.723
3 United States       6Y -0.756
4 United States       8Y  0.601
5 United States      10Y -0.531
6 United States      12Y  0.479
7 United States      14Y -0.354
8 United States      16Y  0.319</code></pre>
</div>
</div>
<p>As usual, these data are much easier to digest visually. Let’s plot those autocorrelation coefficients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(us_turnout_autocor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turnout-acf" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-turnout-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-turnout-acf-1.png" id="fig-turnout-acf" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-turnout-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.7
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-turnout-acf" class="quarto-xref">Figure&nbsp;<span>4.7</span></a> shows the value of the autocorrelation as a spike emerging from the x-axis. A line descending below the x-axis indicates a negative correlation and, conversely, a line ascending above the x-axis indicates a positive one. Stronger correlations are shown by longer lines.</p>
<p>Voter turnout rates for mid-term and presidential elections are different. This is shown by the negative autocorrelation at odd-numbered intervals. Turnout rates for like-elections (mid-term and mid-term, or presidential and presidential) are similar to each other, or <strong>positively autocorrelated</strong>. The clear pattern in these autocorrelations (negative, positive, negative, positive, etc.) is evidence of seasonality.</p>
</section>
<section id="white-noise" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="white-noise"><span class="header-section-number">4.2.2</span> White noise</h3>
<p>Sure, turnout rates in like elections look alike, but are they really <em>that</em> similar. How confident can we be that they are sufficiently similar to each other to indicate a pattern? To answer this question, I will make up some data that are genuinely random. By design, there are no patterns (seasons or cycles) in these data.</p>
<p>I use <code>rbinom()</code> to randomly sample from a <a href="https://en.wikipedia.org/wiki/Binomial_distribution">binomial distribution</a>. <em>These data points do not relate to one another.</em> I should find no meaningful patterns within them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>random_ts <span class="ot">&lt;-</span> <span class="fu">tsibble</span>(<span class="at">sample =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">value =</span> <span class="fu">rbinom</span>(<span class="dv">50</span>, <span class="dv">50</span>, <span class="at">prob =</span> <span class="fl">0.5</span>), </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">index =</span> sample)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(random_ts, value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04_time_series_decomposed_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s calculate the autocorrelation coefficients, as we did above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ACF</span>(random_ts) <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-random-acf" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-random-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-random-acf-1.png" id="fig-random-acf" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-random-acf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.8
</figcaption>
</figure>
</div>
</div>
</div>
<p>There is some autocorrelation: these data are not completely different from one another. This is normal, but we need some way of distinguishing this white noise from meaningful correlations. Borrowing from frequentist statistics, we need some threshold beyond which we are willing to say that these autocorrelation coefficients are sufficiently different from zero for us to consider them meaningful associations.</p>
<p>Autocorrelation coefficients from an infinitely large random sample follow a Normal distribution centered at zero. Don’t take my word for it: <a href="#fig-acf-theory" class="quarto-xref">Figure&nbsp;<span>4.9</span></a> shows the autocorrelations among a very large random sample<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> from a binomial distribution<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. They fall along that lovely bell-shaped curve.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>large_random_ts <span class="ot">&lt;-</span> <span class="fu">tsibble</span>(<span class="at">sample =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">1e5</span>, <span class="at">value =</span> <span class="fu">rbinom</span>(<span class="fl">1e5</span>, <span class="at">size =</span> <span class="fl">1e5</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">prob =</span> <span class="fl">0.5</span>), </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">index =</span> sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>large_random_acf <span class="ot">&lt;-</span> <span class="fu">ACF</span>(large_random_ts, <span class="at">lag_max =</span> <span class="fl">1e5</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> large_random_acf<span class="sc">$</span>acf)) <span class="sc">+</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-acf-theory" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-acf-theory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-acf-theory-1.png" id="fig-acf-theory" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-acf-theory-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.9
</figcaption>
</figure>
</div>
</div>
</div>
<p>This is very handy because we know what proportion of those infinite values fall at any point along a standard Normal distribution (centered at zero and with a standard deviation of one). For example, we know that 95 percent of these values fall between roughly 1.96 standard deviations above and below that center point.</p>
<p>So, if our values are random and there is no relationship between them, we will get autocorrelation coefficients between them that are Normally distributed with a center point of zero. Now, we can place any autocorrelation coefficient we do find in our data within this context. I can calculate how likely I was to get that coefficient or a more extreme one if my values are, in fact, just random.</p>
<p>Look again at <a href="#fig-acf-theory" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>. A lot of the coefficients from that completely random draw sit between -0.005 and 0.005. So, if I get a coefficient within that range it is very plausible that it resulted from a completely random sample. I don’t have enough evidence that the relationship is anything other than white noise. If; however, I get a coefficient of, say, 0.010 or higher, I’m starting to get a bit suspicious of the idea that the values are random. It is <em>really unlikely</em> that I would find a coefficient that big if they were.</p>
<p>In the sciences, we generally accept a five percent chance that we will incorrectly say that the value we found was so extreme that it provides us with good evidence our data are not random. This five percent threshold is commonly referred to as <code>p = 0.05</code>: you should remember it from any statistics courses you have taken.</p>
<p>So, we know that 95 percent of the autocorrelation coefficients that could plausibly result from random values fall 1.96 standard deviations away from a standardized Normal distribution. So if the coefficients we find in our data fall further from their center than 1.96 standard deviations above and below it, we have good evidence to reject the idea that these data are not autocorrelated. Gosh, that was a lot of double negatives. Frequestist statistics requires us to stretch our intuition a little far.</p>
<p>To locate our autocorrelation coefficient on this standard Normal distribution, we ask whether it lies outside of <span class="math inline">\(\pm \frac{1.96}{\sqrt{T}}\)</span>, where <span class="math inline">\(T\)</span> is the length of the time series. Conveniently, <code>autoplot()</code> plots those boundaries for us (the dashed blue lines on <a href="#fig-turnout-acf" class="quarto-xref">Figure&nbsp;<span>4.7</span></a> and <a href="#fig-random-acf" class="quarto-xref">Figure&nbsp;<span>4.8</span></a>).</p>
<p>From <a href="#fig-turnout-acf" class="quarto-xref">Figure&nbsp;<span>4.7</span></a>, we can see that the first four lagged election years exceed this threshold. They are sufficiently different from zero. In other words, they are sufficiently similar to one another to suggest a meaningful relationship. Our white noise (<a href="#fig-random-acf" class="quarto-xref">Figure&nbsp;<span>4.8</span></a>), on the other hand, never meets this threshold. Good! It’s just random values plucked from a binomial distribution.</p>
<p>Interestingly, the degree to which turnout rates a similar to each other decrease over time. Elections that were more than four elections away from each other are too different from each other to suggest they are related. This hints at a trend. Looking back at <a href="#fig-us-turnout" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>, it appears that the turnout rate for US elections is increasing. A greater proportion of eligible voters showed up in recent elections than in elections held in the late 1990s and early 2000s.</p>
</section>
</section>
<section id="decomposing-time-series" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="decomposing-time-series"><span class="header-section-number">4.3</span> Decomposing time series</h2>
<p>We have identified both a trend and seasonality in US general election voter turnout rates. How can we isolate those components? In other words, how can we extract the overall trend and identify the seasonal pattern in our data?</p>
<p>We can decompose a time series into three parts: its trend-cycle, seasonal, and remainder components. I will discuss how we do this shortly. But first, it is helpful to see the end result. Here are those three components of the voter turnout data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dcmp <span class="ot">&lt;-</span>  us_turnout_ts <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"United States"</span>, year <span class="sc">&gt;=</span> <span class="dv">1998</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(vep_turnout_rate <span class="sc">~</span> <span class="fu">season</span>(<span class="at">period =</span> <span class="st">"4 years"</span>)))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A dable: 13 x 8 [2Y]
# Key:     state, .model [1]
# :        vep_turnout_rate = trend + `season_4 years` + remainder
   state         .model  year vep_turnout_rate trend `season_4 years` remainder
   &lt;chr&gt;         &lt;chr&gt;  &lt;dbl&gt;            &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;     &lt;dbl&gt;
 1 United States stl     1998             39.3  47.4            -9.25    1.20  
 2 United States stl     2000             55.3  48.2             9.26   -2.17  
 3 United States stl     2002             40.5  49.2            -9.28    0.551 
 4 United States stl     2004             60.9  50.8             9.29    0.768 
 5 United States stl     2006             41.4  51.6            -9.30   -0.865 
 6 United States stl     2008             62.2  51.5             9.32    1.34  
 7 United States stl     2010             41.0  50.7            -9.34   -0.397 
 8 United States stl     2012             58.6  48.6             9.37    0.592 
 9 United States stl     2014             36.6  48.3            -9.39   -2.26  
10 United States stl     2016             60.1  51.9             9.41   -1.16  
11 United States stl     2018             50.0  56.1            -9.41    3.33  
12 United States stl     2020             66.0  56.5             9.41    0.0952
13 United States stl     2022             46.1  56.2            -9.41   -0.661 
# ℹ 1 more variable: season_adjust &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The output provides the observed voter turnout rate (<code>vep_turnout_rate</code>) and then the three component parts (<code>trend</code>, <code>season_4_ years</code>, and <code>remainder</code>).</p>
<p>The trend component captures the broad pattern found within the series. It ignores any seasonal or random fluctuations. As <a href="#fig-us-turnout-trend" class="quarto-xref">Figure&nbsp;<span>4.10</span></a> shows, turnout at general elections is increasing over time. There is a slight dip in turnout in 2012 and 2014 (Obama’s second term, and the mid-term election that followed). This dip is much clearer when we strip the seasonality and random noise from the overall trend.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-us-turnout-trend" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-us-turnout-trend-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-us-turnout-trend-1.png" id="fig-us-turnout-trend" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-us-turnout-trend-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.10
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can look at all three components, and the observed turnout rates, in <a href="#fig-us-turnout-dcmp" class="quarto-xref">Figure&nbsp;<span>4.11</span></a>. The seasonal component captures the extent to which voter turnout changes between mid-term and presidential election years. Interestingly, this appears to be consistent across our data: the extent to which a smaller proportion of people turnout to vote in mid-term elections compared to presidential ones has not changed since the late 1990s. Again, this is difficult to see when we don’t remove the (positive) trend from the data.</p>
<p>The remainder captures whatever variation exists in our data that are not accounted for by the trend and seasonal fluctuations.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-us-turnout-dcmp" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-us-turnout-dcmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-us-turnout-dcmp-1.png" id="fig-us-turnout-dcmp" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-us-turnout-dcmp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.11
</figcaption>
</figure>
</div>
</div>
</div>
<p>This is an <strong>additive decomposition</strong>, so you can get the observed turnout rate in any given election year by simply adding these three components together. This is appropriate because the magnitude of the seasonal fluctuations has not changed over time.</p>
<p>Alternatively, we can calculate a <strong>multiplicative decomposition</strong>, in which the observed values are the product of the trend, seasonal, and remainder components. This method is best used when the seasonal component changes over time. For example, if the difference between turnouts in mid-term and presidential elections increased or decreased over time.</p>
<section id="calculating-the-components-of-your-time-series" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="calculating-the-components-of-your-time-series"><span class="header-section-number">4.3.1</span> Calculating the components of your time series</h3>
<p>There are many different ways to decompose your time series. Here, we will focus on STL, which stands for Seasonal and Trend decomposition using LOESS. LOESS is a method for estimating non-linear relationships. Details of how STL (and LOESS) is calculated can be found in <span class="citation" data-cites="cleveland1990">Cleveland, Cleveland, and Terpenning (<a href="references.html#ref-cleveland1990" role="doc-biblioref">1990</a>)</span>.</p>
<p>You need to make two important decisions when using STL: the <strong>trend-cycle window</strong> and the <strong>seasonal window</strong>. These control how rapidly the trend-cycle and seasonal components can change, with smaller values allowing for more rapid changes.</p>
<p>The trend-cycle window is the number of consecutive observations you want to use to estimate the trend-cycle. It must be an odd number. A larger window results in a smoother trend-cycle line. Therefore, your model is less responsive to short-term fluctuations. A very large window can lead to oversmoothing, where some genuine cyclical variation is mistakenly pushed into the remainder component.</p>
<p>A smaller window uses a smaller number of observations. This results in a more flexible or wiggly trend-cycle line, allowing it to closely follow rapid rises and falls in the data. A very small window can lead to overfitting, where the trend-cycle captures too much of the irregular or seasonal variation.</p>
<p>In general, you should use a number larger than the seasonal period of the data. For example, our seasonal pattern in US general election turnout rates runs over four years. Our trend cycle window should, therefore, be larger than four. Choosing the right window is a trade-off between capturing the true long-term movement and being overly sensitive to short-term noise.</p>
<p>To illustrate, <a href="#fig-dcmp-trend" class="quarto-xref">Figure&nbsp;<span>4.12</span></a> shows the STL calculated with two different trend-cycle windows: a short one of seven, and a long one of 21. The longer window completely misses the dip during Obama’s second term and the subsequent mid-term election. (The dip is relegated to the remainder component.)</p>
<p>Which one should you use? Which ever one you think better represents the time series. We will discuss formal methods for comparing models later in the course, but your gut feeling (informed by your knowledge of the thing you are trying to model) is a wonderful asset. Trust it. For what it’s worth, I would pick the seven-year window.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dcmp-trend" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dcmp-trend-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-dcmp-trend-1.png" id="fig-dcmp-trend" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-dcmp-trend-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.12
</figcaption>
</figure>
</div>
</div>
</div>
<p>The seasonal window directly controls the rate at which the seasonal pattern is allowed to change over the length of the time series. It must also always be an odd number. A smaller window is more flexible. It allows the seasonal pattern to change more quickly over time. This is useful if you believe the seasonality is evolving or adapting (e.g., people’s holiday shopping habits are shifting). A larger window is less flexible or smoother. The seasonal pattern is held more constant over time. This is used if you believe the underlying seasonality is very stable. You can also set the seasonal window to be periodic or infinite. This forces the pattern to be completely fixed. The seasonal pattern is identical across all periods.</p>
<p><a href="#fig-dcmp-season" class="quarto-xref">Figure&nbsp;<span>4.13</span></a> compares a short (5 year), long (11 year), and periodic (fixed) window for US voter turnout. They are all very similar because the difference between voter turnout in presidential and mid-term elections has not changed all that much across these two-and-a-half decades of data.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dcmp-season" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dcmp-season-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04_time_series_decomposed_files/figure-html/fig-dcmp-season-1.png" id="fig-dcmp-season" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-dcmp-season-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.13
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonally-adjusted-data" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="seasonally-adjusted-data"><span class="header-section-number">4.3.2</span> Seasonally-adjusted data</h3>
<p>If you do not care about the variation due to seasonality, you should remove it from your model of the relationship between time and our outcome of interest. This leaves you with the trend and remainder components. When we do this, we call the data “seasonally-adjusted”.</p>
<p>You should use seasonally-adjusted time series data to analyze underlying trends and compare movements between different time periods, as it removes the predictable, repeating patterns (like holiday shopping or weather effects) that naturally occur within a year. This allows you to see the “true” non-seasonal changes. It is useful for understanding short-term fluctuations beyond the usual patterns.</p>
<p>However, if you want to find turning points in a series, and interpret any changes in direction, then you should use the trend-cycle component (as shown in <a href="#fig-us-turnout-trend" class="quarto-xref">Figure&nbsp;<span>4.10</span></a> for US voter turnouts) rather than the seasonally-adjusted data. The remainder component can distract from this analysis.</p>
</section>
</section>
<section id="measuring-the-strength-of-trend-and-seasonality-in-a-time-series" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="measuring-the-strength-of-trend-and-seasonality-in-a-time-series"><span class="header-section-number">4.4</span> Measuring the strength of trend and seasonality in a time series</h2>
<p>This decomposition is additive: you can reconstruct the observed voter turnout rate by adding together the trend-cycle, seasonal, and remainder components. Formally:</p>
<p><span class="math display">\[
y_t = T_t + S_t + R_t
\]</span></p>
<p>Where <span class="math inline">\(y_t\)</span> is the observed value at time <span class="math inline">\(t\)</span>, <span class="math inline">\(T_t\)</span> is the trend_cycle component, <span class="math inline">\(S_t\)</span> is the seasonal component, and <span class="math inline">\(R_t\)</span> is the remainder component.</p>
<p>We can isolate the strength of the trend-cycle component by looking at how much variation in the seasonally-adjusted data come from that component. If the data are <strong>strongly trended</strong> (most of the pattern we see is driven by the overall trend, rather than seasonality or random noise), the amount of variation in the remainder component relative to all variation in the seasonally-adjusted data should be small.</p>
<p>A common measure of the strength of the trend in time series is, therefore:</p>
<p><span class="math display">\[
F_T = max(0, 1 - \frac{Var(R_t)}{Var(R_t + T_t)})
\]</span></p>
<p>This gives us a measure of the strength of the trend that lies between 0 and 1, with higher values indicating that the trend is driving the pattern we see in the data.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> The strength of seasonality is defined similarly, but with respect to the detrended data rather than the seasonally adjusted data:</p>
<p><span class="math display">\[
F_S = max(0, 1 - \frac{Var(R_t)}{Var(R_t + S_t)})
\]</span></p>
<p>Before we calculate the strength of trend and seasonality in US voter turnout, guess how you think they will compare. Do you think the time series is very seasonal? Or do you think the pattern is driven by that overall positive trend in turnout?</p>
<p>Let’s first calculate these manually:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dcmp <span class="ot">&lt;-</span> us_turnout_ts <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"United States"</span>, year <span class="sc">&gt;=</span> <span class="dv">1998</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(vep_turnout_rate <span class="sc">~</span> <span class="fu">season</span>(<span class="at">period =</span> <span class="st">"4 years"</span>, <span class="at">window =</span> <span class="st">"periodic"</span>) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">7</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>strength_trend <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, <span class="dv">1</span> <span class="sc">-</span> (<span class="fu">var</span>(dcmp<span class="sc">$</span>remainder) <span class="sc">/</span> <span class="fu">var</span>(dcmp<span class="sc">$</span>season_adjust)))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>strength_trend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6665958</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>strength_season <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, <span class="dv">1</span> <span class="sc">-</span> (<span class="fu">var</span>(dcmp<span class="sc">$</span>remainder) <span class="sc">/</span> <span class="fu">var</span>(dcmp<span class="sc">$</span><span class="st">`</span><span class="at">season_4 years</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                                           dcmp<span class="sc">$</span>remainder)))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>strength_season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.947254</code></pre>
</div>
</div>
<p>US voter turnout is strongly seasonal and moderately trended. This passes my vibe check!</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-cleveland1990" class="csl-entry" role="listitem">
Cleveland, Robert B., William S. Cleveland, and Irma Terpenning. 1990. <span>“STL: a seasonal-trend decomposition procedure based on loess.”</span> <em>Journal of official statistics</em> 6 (1): 333.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>I use a sample of 100,000 for illustrative purposes. Sadly, I can’t take an infinitely large sample.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Autocorrelation coefficients will be Normally distributed when drawn from a large sample of any distribution!<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>For very noisy time series, variation in the remainder (<span class="math inline">\(Var(R_t)\)</span>) might be larger than the variation in the seasonally-adjusted data (<span class="math inline">\(Var(R_t + T_t)\)</span>). Hence, the floor of zero.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03_time_series_r.html" class="pagination-link" aria-label="The Toolkit: R for Time Series">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The Toolkit: R for Time Series</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>